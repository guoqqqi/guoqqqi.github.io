---
title: APISIX åœ¨ arm ç‰ˆ ubuntu æ„å»ºè¸©å‘æ—¥è®°
date: 2022-01-07
---

æœ¬ç¯‡æ–‡ç« è®°å½•äº†é€šè¿‡æºç æ„å»º APISIX çš„è¸©å‘è®°å½•ï¼Œubuntu ç¯å¢ƒä½¿ç”¨çš„æ˜¯ [https://multipass.run/](https://multipass.run/) ä¸­çš„ Multipass ã€‚

## å…‹éš†æºç 

é¦–å…ˆæ ¹æ® [å®˜æ–¹æ–‡æ¡£](https://apisix.apache.org/zh/docs/apisix/how-to-build#%E9%80%9A%E8%BF%87%E6%BA%90%E7%A0%81%E5%8C%85%E5%AE%89%E8%A3%85) å®‰è£… APISIX æºç ä»“åº“ã€‚å¹¶ä¸”è¿›å…¥é¡¹ç›®æ–‡ä»¶ã€‚

```shell
cd apisix-2.11.0
```

## å®‰è£…é¡¹ç›®ä¾èµ–

1. ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡è„šæœ¬ä¸€é”®å®‰è£…é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–æ‹‰ï¼Œåœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š

```shell
bash utils/install-dependencies.sh
```

![1.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/1.png)

ä¸å‡ºæ‰€æ–™ï¼Œæ²¡æœ‰æˆåŠŸè·‘å®Œã€‚é€šè¿‡é”™è¯¯æç¤ºæˆ‘ä»¬çŸ¥é“ï¼Œè¿™é‡Œæ˜¯æœªèƒ½æˆåŠŸå®‰è£… `OpenResty`ã€‚åŸå› æ˜¯é»˜è®¤æ²¡æœ‰ `arm 64` å¹³å°çš„æºã€‚

2. ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ä¸‹ OpenRestyï¼šå‚è€ƒ [https://openresty.org/cn/linux-packages.html#ubuntu](https://openresty.org/cn/linux-packages.html#ubuntu)

- æ­¥éª¤ä¸€ï¼šå®‰è£…å¯¼å…¥ GPG å…¬é’¥æ—¶æ‰€éœ€çš„å‡ ä¸ªä¾èµ–åŒ…ï¼ˆæ•´ä¸ªå®‰è£…è¿‡ç¨‹å®Œæˆåå¯ä»¥éšæ—¶åˆ é™¤å®ƒä»¬ï¼‰ï¼š

```shell
sudo apt-get -y install --no-install-recommends wget gnupg ca-certificates
```

- æ­¥éª¤äºŒï¼šå¯¼å…¥æˆ‘ä»¬çš„ GPG å¯†é’¥ï¼š

```shell
wget -O - https://openresty.org/package/pubkey.gpg | sudo apt-key add -
```

æˆåŠŸï¼š

![2.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/2.png)

- æ­¥éª¤ä¸‰ï¼šæ·»åŠ  OpenResty å®˜æ–¹ APT ä»“åº“ã€‚å¯¹äº x86_64 æˆ– amd64 ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

```shell
echo "deb http://openresty.org/package/ubuntu $(lsb_release -sc) main" \
    | sudo tee /etc/apt/sources.list.d/openresty.list
```

- è€Œå¯¹äº arm64 æˆ– aarch64 ç³»ç»Ÿï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:ï¼ˆæˆ‘åœ¨ M1 ä¸Šè¿è¡Œçš„æ˜¯è¯¥å‘½ä»¤ï¼Œä¸Šä¸ªå‘½ä»¤ä¼šæŠ¥é”™ï¼‰

```shell
echo "deb http://openresty.org/package/arm64/ubuntu $(lsb_release -sc) main" \
    | sudo tee /etc/apt/sources.list.d/openresty.list
```

- æ­¥éª¤å››ï¼šæ›´æ–° APT ç´¢å¼•ï¼š

```shell
sudo apt-get update
```
ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚ `OpenResty`ï¼š

```shell
sudo apt-get -y install openresty
```

- æ­¥éª¤äº”ï¼šï¼ˆå¯é€‰ï¼‰å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤åˆ é™¤è¯¥åŒ…å’Œå¯¹åº”çš„å…³è”åŒ…ï¼š

```shell
sudo apt-get -y install --no-install-recommends software-properties-common
```

æˆåŠŸå®‰è£… `OpenResty` :

![3.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/3.png)

3. é‡æ–°è¿è¡Œå®‰è£…ä¾èµ–è„šæœ¬ ï¼ˆå‚è€ƒä¸Šé¢ 1. ï¼‰
4. æ¥ç€è¿è¡Œ `LUAROCKS_SERVER=https://luarocks.cn` å‘½ä»¤å®‰è£…ä¾èµ–ï¼š

![4.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/4.png)

è¿è¡Œä¸‹é¢å‘½ä»¤å³å¯ï¼š

```shell
curl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -
```

![5.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/5.png)

åˆå‡ºç°é”™è¯¯æç¤ºäº†ã€‚ã€‚ã€‚æ¥ç€è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š

```shell
sudo apt install wget sudo unzip
```

æ¥ç€æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€æ¬¡ï¼š

```shell
curl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -
```

ç„¶åæˆ‘ä»¬ç»§ç»­è¿è¡Œå®‰è£…ä¾èµ–çš„å‘½ä»¤ï¼š`LUAROCKS_SERVER=https://luarocks.cn make deps`
ç»ˆäºæˆåŠŸäº†ï¼Œå“­äº†ï¼Œå‘ç¡®å®å¤ªå¤šäº†ã€‚

![6.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/6.png)

å¤§éƒ¨åˆ†ä¾èµ–å·²ç»æˆåŠŸå®‰è£…å¥½ï¼Œä½†æ˜¯åˆæœ‰æ–°çš„é”™è¯¯æç¤ºäº†ã€‚
è¿™é‡Œçœ‹èµ·æ¥æ˜¯ä¸¤ä¸ªä»“åº“æœªèƒ½æˆåŠŸå…‹éš†ä¸‹æ¥ï¼Œæ²¡å…³ç³»ï¼Œå…ˆå¾€åé¢è¿è¡Œè¯•è¯•ï¼š

5. å®‰è£… APISIX å‘½ä»¤

```shell
make install
// å¦‚æœå‡ºç°æƒé™ä¸è¶³çš„æç¤ºï¼Œç”¨ sudo make install
```

æˆåŠŸï¼š

![7.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/7.png)

## å®‰è£… etcd

### è¸©å‘ etcd

å¯åŠ¨ APISIX ä¹‹å‰éœ€è¦å®‰è£…ä¸‹ etcdï¼Œå‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://apisix.apache.org/docs/apisix/2.10/install-dependencies/#ubuntu-1604--1804)

>ï¼ˆç”±äºè¯¥å®‰è£…æ•™ç¨‹å¹¶ä¸æ˜¯é’ˆå¯¹ arm å†™çš„ï¼Œæ‰€ä»¥è™½ç„¶æˆåŠŸå®‰è£…äº† etcdï¼Œä½†æ˜¯æœªèƒ½æˆåŠŸå°† etcd è¿è¡Œèµ·æ¥ï¼ŒåŸå› æ˜¯å› ä¸ºé»˜è®¤ä½¿ç”¨çš„ x86 çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨ï¼Œæ‰€ä»¥æ— æ³•è¿è¡Œã€‚å¯ä»¥è·³è¿‡è¯¥éƒ¨åˆ†ç›´æ¥å‚è€ƒåœ¨ ã€Œdocker ä¸­è¿è¡Œ etcd æœåŠ¡ã€éƒ¨åˆ†ï¼‰

- ç¬¬ä¸€æ­¥è¿è¡Œï¼š

```shell
wget https://github.com/etcd-io/etcd/releases/download/v3.4.13/etcd-v3.4.13-linux-amd64.tar.gz
```

- ç¬¬äºŒéƒ¨è¿è¡Œï¼š

```shell
tar -xvf etcd-v3.4.13-linux-amd64.tar.gz && \    cd etcd-v3.4.13-linux-amd64 && \    sudo cp -a etcd etcdctl /usr/bin/
```

æˆåŠŸï¼š

![8.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/8.png)

- ç¬¬ä¸‰éƒ¨å¯åŠ¨ etcd æœåŠ¡

```shell
nohup etcd &
```

![9.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/9.png)

ç„¶åæˆ‘åœ¨åé¢è¿è¡Œ APISIX æ—¶å‘ç° etcd æŠ¥é”™äº†ï¼š

![10.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/10.png)

å‘ç°åœ¨ arm ä¸Šçš„ ubuntu è£¸è·‘ etcd å‘å¤ªå¤šäº†ï¼Œå„ç§å„æ ·çš„é”™è¯¯ï¼Œåæ¥å†³å®šè¿˜æ˜¯è·‘ docker å§ï½

### åœ¨ docker ä¸­è¿è¡Œ etcd æœåŠ¡

1. å®‰è£… docker 

```shell
sudo apt install docker.io
```

Tip: docker å¸¸ç”¨çš„å‘½ä»¤ï¼š(æ— æƒé™é”™è¯¯åœ¨å‘½ä»¤å‰æ·»åŠ  sudo)
- æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åˆ—è¡¨ docker ps -a
- æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨ docker ps
- æŸ¥çœ‹é•œåƒåˆ—è¡¨ docker image list
- åˆ é™¤æ‰€æœ‰å®¹å™¨ docker container prune
- åˆ é™¤æ‰€æœ‰é•œåƒ docker image prune -f -a
æ›´å¤šå‚è€ƒï¼š[Docker å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)

2. æ‹‰å–å¹¶è¿è¡Œ etcd

```shell
sudo docker run -d --name etcd -p 2379:2379 -e ETCD_UNSUPPORTED_ARCH=arm64 -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 gcr.io/etcd-development/etcd:v3.5.1-arm64
```

æ³¨æ„ï¼šè¯¥é•œåƒéœ€è¦å¼€ä»£ç†ã€‚
æˆåŠŸï¼š

![11.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/11.png)

éªŒè¯æ˜¯å¦è¿è¡Œï¼š

```shell
sudo docker ps -a
```

![12.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/12.png)

è¿™æ ·ï¼Œetcd å·²ç»æˆåŠŸå¯åŠ¨äº†ã€‚

## å¯åŠ¨ APISIX

æ‰€æœ‰çš„ä¾èµ–é¡¹ç›®å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¯åŠ¨ APISIX æ‹‰ï½ç›´æ¥å‚è€ƒå¦‚ä½•æ„å»º APISIX [å®˜æ–¹æ–‡æ¡£](https://apisix.apache.org/docs/apisix/how-to-build)

- ç¬¬ä¸€æ­¥å®‰è£…ä¾èµ–

```shell
make deps
make install
```

- ç¬¬äºŒéƒ¨åˆå§‹åŒ–ä¾èµ–ï¼Œå¯åŠ¨ APISIX

```shell
apisix init

// start APISIX
apisix start

// stop APISIX
apisix stop
```

![13.png](https://guoqi-test-1307026204.cos.ap-shanghai.myqcloud.com/202108/13.png)

æ²¡æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯äº†ï¼Œå®Œç¾æ”¶å·¥ï¼

## æ€»ç»“ï¼š

æ€»ä½“æ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªå¤§å‘æ˜¯å®‰è£… APISIX ä¾èµ–éƒ¨åˆ†å’Œ arm çš„ etcd éƒ¨åˆ†ï¼Œetcd éƒ¨åˆ†å¯ä»¥ç›´æ¥ç”¨ docker æ¥è§£å†³ï¼Œä¸è¿‡åœ¨æ‹‰å–é•œåƒçš„æ—¶å€™ä¹Ÿä¼šæœ‰ä¸€äº›å‘ï¼Œç›´æ¥æ¢åˆ«çš„é•œåƒå°è¯•å°±å¥½ã€‚å¦‚æœä»¥ååˆ«äººå†é—®æˆ‘ç”¨ M1 å¼€å‘æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Œé‚£æˆ‘å°±å»ºè®®ï¼šççˆ±ç”Ÿå‘½ï¼Œè¿œç¦» M1 ğŸ˜‚ -- å¼•è‡ªç™½æ³½å¹³åŒå­¦ã€‚
